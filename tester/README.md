# Tester Instructions

## Compiling Environ

From Environ's root directory:

- run `./configure`
- run `make -j# compile`, where # is the number of processors to use for compilation

## Preparing the tester program

From Environ/tester:

- to use a given tester routine, add the relevant CALL statement in `tester.f90`:

  ```
  !------------------------------------------------------------------------------------
  !
  !                                   SELECT PROGRAM
  !
  !------------------------------------------------------------------------------------
  !
  CALL routine(arguments) <-- call to selected routine
  !
  !------------------------------------------------------------------------------------
  ```

  - for example, to run an Environ calculation on a static density from a cube file, add <br>
    `CALL run_environ_from_cube()`

  - see subroutine docstrings for further detail on each feature

## Compiling the tester

- run `make`

## Running the calculation

From the folder holding all the relevant input files for the calculation:

- run `tester_dir/tester.x`, where `tester_dir` is the absolute or relative path of the tester
- to run in parallel, prefix `mpirun -n #` to the above command, replacing `#` with <br>
  the number of processors to use in parallel

<br>

# Tester features

## `run_environ_from_cube`

Compute environment contributions to properties of a "frozen" density given as a cube file

### Requirements

- Environ input file and cube file names may be provided in the CALL statement <br>
  (see routine docstring for default argument values)

- Environ is unable to determine exactly the energy cutoff used in the calculation that <br>
  produced the cube file. Though an algorithm for slightly overestimating the cutoff <br>
  value is implemented in Environ, we recommend the user to provide the cutoff value <br>
  as `env_ecut` (Ry) in the &ENVIRON section of the input. This value can be obtained <br>
  from prior knowledge of the system, or by running convergence testing w.r.t total <br>
  energy difference

- atomic charges must be provided in the cube file header. These depend on the type of <br>
  calculation that produced the cube file. Replace `charge` with the atomic charge of the <br>
  corresponding species

  ```
  CUBE FILE GENERATED BY PW.X
  OUTER LOOP: X, MIDDLE LOOP: Y, INNER LOOP: Z
    3    0.000000    0.000000    0.000000
  120    0.166667    0.000000    0.000000
  120    0.000000    0.166667    0.000000
  120    0.000000    0.000000    0.166667
    8     charge    11.790000   12.050000   11.500000
    1     charge    13.450000   11.220000   11.500000
    1     charge    10.560000   10.660000   11.500000
  ```
