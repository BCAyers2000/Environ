# Copyright (C) 2018 ENVIRON (www.quantum-environment.org)
#
#    This file is part of Environ version 1.0
#
#    Environ 1.0 is free software: you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation, either version 2 of the License, or
#    (at your option) any later version.
#
#    Environ 1.0 is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU General Public License for more detail, either the file
#    `License' in the root directory of the present distribution, or
#    online at <http://www.gnu.org/licenses/>.
#
# Compilation instructions for ENVIRON module
#
# Authors: Oliviero Andreussi (Department of Physics, University of North Thexas)
#          Francesco Nattino  (THEOS and NCCR-MARVEL, Ecole Polytechnique Federale de Lausanne)
#          Iurii Timrov       (THEOS and NCCR-MARVEL, Ecole Polytechnique Federale de Lausanne)
#          Ismaila Dabo       (Department of Materials Science and Engineering, Penn State)
#          Nicola Marzari     (THEOS and NCCR-MARVEL, Ecole Polytechnique Federale de Lausanne)
#

This is the distribution of the ENVIRON module for Quantum ESPRESSO.
These are the steps to compile Quantum ESPRESSO with the Environ module,
for more information on installation and usage of the module, please
check the web site http://www.quantum-environment.org/

Preliminary steps:

   -1) configure QE following the standard procedure (running
          ./configure from QE main dir should be enough in most cases)
    0) compile QE without the Environ module (e.g. running
          make pw from QE main dir)

If there are problems with the preliminary steps, look up for solutions
on the PW-forum or refer to the Quantum ESPRESSO documentation and web site
http://www.quantum-espresso.org/

For PW and NEB:

    1) in QE main dir run the script addsonpatch.sh
          ./install/addsonpatch.sh Environ Environ/src Modules -patch
    2) in PW/src dir run
          ../../Environ/patches/environpatch.sh -patch
    3) in install dir run
          ./makedeps.sh -addson Modules Modules
          ./makedeps.sh PW/src
    4) in QE main dir re-compile pw and neb
          make pw
          make neb
    5) run pw.x with argument pw.x -environ

For TDDFPT:
    6) in the QEDIR/make.inc file generated by ./configure
       add -D__ENVIRON to the MANUAL_DFLAGS variable
    7) in TDDFPT/src dir run
          ../../Environ/patches/td-patch.sh
    8) in install dir run
          ./makedeps.sh TDDFPT/src
    9) in QE main dir
          make tddfpt
   10) run executables with -environ flag

For CP:
   11) in CPV/src dir run
          ../../Environ/patches/cp-patch.sh
   12) in install dir run
          ./makedeps.sh ../CPV/src
   13) in QE main dir re-compile cp
          make cp
   14) run cp.x with argument cp.x -environ

To clean up the compilation with Environ follow these steps:

    1) in QE main dir run the script addsonpatch.sh
          ./install/addsonpatch.sh Environ Environ/src Modules -revert
    2) in PW/src dir run
          ../../Environ/patches/environpatch.sh -revert
    3) in TDDFPT/src dir run
          ../../Environ/patches/td-revert.sh
    4) in CPV/src dir run
          ../../Environ/patches/cp-revert.sh
    5) be sure to remove objects, modules and executables
          make clean

